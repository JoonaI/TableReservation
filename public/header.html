<header>
    <h1>Ravintola Ryhmä C</h1>
    <nav>
        <ul>
            <li><a href="index.html">Koti</a></li>
            <li><a href="reservations.html">Varaukset</a></li>
            <li><a href="contact.html">Yhteystiedot</a></li>
            <li><a href="register.html" id="register-link">Rekisteröidy</a></li>
            <li class="user-specific" style="display:none;"><a href="profile.html">Oma profiili</a></li>
            <li class="user-specific" style="display:none;"><a href="hallintapaneeli.html">Hallintapaneeli</a></li>
            <form id="login-form">
                <label for="login-username">Käyttäjänimi:</label>
                <input type="text" id="login-username" required>   
                <label for="login-password">Salasana:</label>
                <input type="password" id="login-password" required>         
                <button type="submit">Kirjaudu sisään</button>
                <button type="button" id="reset-password-button">Resetoi salasana</button>
            </form>
            <button id="logout-button" style="display:none;">Kirjaudu ulos</button>
        </ul>
    </nav>
</header>



<script>
    document.addEventListener("DOMContentLoaded", function() {
        const token = localStorage.getItem('token');
        if (token) {
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('register-link').style.display = 'none'; 
            const userSpecificElements = document.querySelectorAll('.user-specific');
            userSpecificElements.forEach(elem => elem.style.display = 'block');
            document.getElementById('logout-button').style.display = 'inline-block';
        } else {
            document.getElementById('logout-button').style.display = 'none';
        }

        document.getElementById('logout-button').addEventListener('click', function() {
            localStorage.removeItem('token');
            window.location.reload();
        });

        const loginForm = document.getElementById('login-form');
        if (loginForm) {
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();

                const username = document.getElementById('login-username').value;
                const password = document.getElementById('login-password').value;

                fetch('/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username: username, password: password }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.token) {
                        localStorage.setItem('token', data.token);
                        window.location.reload();
                    } else {
                        alert('Kirjautuminen epäonnistui: ' + (data.message || 'Tuntematon virhe'));
                    }
                })
                .catch(error => {
                    console.error('Kirjautumisessa tapahtui virhe:', error);
                });
            });
        }
    });

    // Salasanan resetointi
    document.getElementById('reset-password-button').addEventListener('click', function() {
        const username = document.getElementById('login-username').value;
        if (!username) {
            alert('Anna käyttäjänimi');
            return;
        }
        // Lähetetään POST-pyyntö /reset-password -reitille
        fetch('/reset-password', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ username: username }),
        }) // Käsitellään vastaus
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Salasanan resetointi onnistui');
            } else {
                alert('Salasanan resetointi epäonnistui: ' + (data.message || 'Tuntematon virhe'));
            }
        }) // Käsitellään mahdollinen virhe
        .catch(error => {
            console.error('Salasanan resetoinnissa tapahtui virhe:', error);
        });
    });

</script>
