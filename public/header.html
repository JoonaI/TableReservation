
<script src="common.js" defer></script>

<header>
    <h1>Ravintola Ryhmä C</h1>
    <nav>
        <ul>
            <li><a href="index.html">Koti</a></li>
            <li><a href="reservations.html">Varaukset</a></li>
            <li><a href="contact.html">Yhteystiedot</a></li>
            <!-- Säilytetään Kirjaudu ja Rekisteröidy linkit ja hallitaan niiden näkyvyyttä -->
            <li id="login-link"><a href="login.html">Kirjaudu</a></li>
            <li id="register-link"><a href="register.html">Rekisteröidy</a></li>
            <!-- Tehdään näkyväksi vain, jos käyttäjä on kirjautunut -->
            <li class="user-specific" style="display:none;"><a href="profile.html">Oma profiili</a></li>
            <li class="user-specific" style="display:none;"><a href="hallintapaneeli.html">Hallintapaneeli</a></li>
        </ul>
    </nav>
    <!--  kirjautumislomake ja "Kirjaudu ulos" -painike -->
    <form id="login-form" style="display:none;">
        <label for="login-username">Käyttäjänimi:</label>
        <input type="text" id="login-username" required>   
        <label for="login-password">Salasana:</label>
        <input type="password" id="login-password" required>         
        <button type="submit">Kirjaudu sisään</button>
        <button type="button" id="reset-password-button">Resetoi salasana</button>
    </form>
    <button id="logout-button">Kirjaudu ulos</button>
</header>

<div id="modal-container"></div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const token = localStorage.getItem('token');
        if (token) {
            // Käyttäjä on kirjautunut sisään, päivitä navigointilinkkien näkyvyys
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('login-link').style.display = 'none';
            document.getElementById('register-link').style.display = 'none';
            document.querySelectorAll('.user-specific').forEach(elem => elem.style.display = 'block');
            document.getElementById('logout-button').style.display = 'inline-block';
            updateHeaderAfterLogin(); 
        } else {
            // Käyttäjä ei ole kirjautunut sisään, näytä kirjautumislomake
            document.getElementById('login-form').style.display = 'block';
        }

        document.getElementById('logout-button').addEventListener('click', function(e) {
            e.preventDefault();

            fetch('/logout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                localStorage.removeItem('token');
                window.location.href = 'index.html'; // Ohjaa käyttäjä etusivulle
            })
            .catch(error => {
                console.error('Uloskirjautumisessa tapahtui virhe:', error);
            });
        });

        // Salasanan resetointi
        document.getElementById('reset-password-button').addEventListener('click', function() {
            const username = document.getElementById('login-username').value;
            if (!username) {
                alert('Anna käyttäjänimi');
                return;
            }
            // Lähetetään POST-pyyntö /reset-password -reitille
            fetch('/reset-password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ username: username }),
            }) // Käsitellään vastaus
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Salasanan resetointi onnistui');
                } else {
                    alert('Salasanan resetointi epäonnistui: ' + (data.message || 'Tuntematon virhe'));
                }
            }) // Käsitellään mahdollinen virhe
            .catch(error => {
                console.error('Salasanan resetoinnissa tapahtui virhe:', error);
            });
        });
        // Päivitä navigointipalkki kirjautumisen jälkeen
        updateHeaderAfterLogin(); // Lisää tämä rivi
    });

    //Salasanan resetointi
    document.getElementById('reset-password-button').addEventListener('click', function() {
        fetch('reset-password-modal.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('modal-container').innerHTML = html;
                document.getElementById('reset-password-modal').style.display = 'block';
                document.getElementById('close-modal').addEventListener('click', function() {
                    document.getElementById('reset-password-modal').style.display = 'none';
                });
            })
            .catch(error => {
                console.error('Virhe ladattaessa modaalista ikkunaa:', error);
            });
    });

</script>