<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oma profiili</title>
    <script src="common.js" defer></script>
    
</head>

<body>

    <!-- Päänavigaatio -->
    <div id="header-placeholder"></div>
    
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            fetch('header.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('header-placeholder').innerHTML = data;
                    updateHeaderAfterLogin();
                });
             // Delegoi kuuntelija document-tasolle ja tarkista, onko klikattu elementti reset-password-button
             document.addEventListener('click', function(event) {
                if (event.target.id === 'reset-password-button') {
                    window.location.href = 'reset-password-page.html';
                }
            }); 
        });
    </script>

    <!-- Pääsisältö -->
    <main id="main-content">
        <section id="profile">
            <h2>Oma profiili</h2>
            <p class="alaotsikko">Tällä sivulla voit muokata tietojasi sekä tarkastella, muokata tai poistaa omia varauksia.</p>
            <form id="profile-form" method="POST" action="/updateProfile">
                <div class="form-group">
                    <label for="name">Etunimi:</label>
                    <input type="text" id="name" name="etunimi" value="NykyinenEtunimi" required>
                </div>

                <div class="form-group">
                    <label for="lastname">Sukunimi:</label>
                    <input type="text" id="lastname" name="sukunimi" value="NykyinenSukunimi" required>
                </div>

                <div class="form-group">
                    <label for="email">Sähköposti:</label>
                    <input type="email" id="email" name="email" value="nykyinen@email.com" required>
                </div>

                <div class="form-group">
                    <label for="username">Käyttäjänimi:</label>
                    <input type="text" id="username" name="username" value="NykyinenKäyttäjänimi" required>
                </div>

                <!-- Salasanan muokkaus voi vaatia erillisen prosessin, joten se voidaan jättää pois tästä näkymästä -->
                <!-- <div class="form-group">
                    <label for="password">Salasana:</label>
                    <input type="password" id="password" name="password" required>
                </div> -->

                <button type="submit">Muokkaa tietoja</button>
            </form>
            <h2>Omat varaukset</h2>
            <ul id="varaukset-lista">
                <!-- Varaukset lisätään tähän -->
              </ul>
        </section>
    </main>

    <!-- Skriptit -->
    <script>

        document.addEventListener('DOMContentLoaded', function() {
            // Kutsu haeVaraukset funktiota kun sivu on täysin ladattu
             haeVaraukset();
        });

        function haeVaraukset() {
            setTimeout(() => {
                // Oletetaan, että tämä on palvelimelta saatu vastaus
                const mockVaraukset = [
                { id: 1, päivämäärä: '2024-02-27', aika: '18:00', henkilomäärä: 4 },
                { id: 2, päivämäärä: '2024-02-28', aika: '19:00', henkilomäärä: 2 }
                ];

                const varauksetLista = document.getElementById('varaukset-lista');
                varauksetLista.innerHTML = '';
                mockVaraukset.forEach(varaus => {
                    varauksetLista.innerHTML += `
                        <li>
                            Varaus ID: ${varaus.id}, Päivämäärä: ${varaus.päivämäärä}, Aika: ${varaus.aika}, Henkilömäärä: ${varaus.henkilomäärä}
                            <button onclick="muokkaaVarausta(${varaus.id})">Muokkaa</button>
                            <button onclick="poistaVaraus(${varaus.id})">Poista</button>
                        </li>`;
                });
            }, 1000); // Simuloi 1 sekunnin verkkoviivettä
        }

        /*
        function haeVaraukset() {
            fetch(`/varausket`) // Oikea API-reitti tähän
                .then(response => response.json())
                .then(varaukset => {
                    const varauksetLista = document.getElementById('varaukset-lista');
                    varauksetLista.innerHTML = ''; // Tyhjennä lista ennen uusien varauksien lisäämistä
                    varaukset.forEach(varaus => {
                        varauksetLista.innerHTML += `
                            <li>
                                Varaus ID: ${varaus.id}, Päivämäärä: ${varaus.päivämäärä}, Aika: ${varaus.aika}, Henkilömäärä: ${varaus.henkilomäärä}
                                <button onclick="muokkaaVarausta(${varaus.id})">Muokkaa</button>
                                <button onclick="poistaVaraus(${varaus.id})">Poista</button>
                            </li>`;
                    });
                })
                .catch(error => console.error('Virhe haettaessa varauksia:', error));
        }
    
        function muokkaaVarausta(varausId) {
            // Tähän voisi lisätä toiminnallisuuden varauksen tietojen muokkaamiseen.
            // Esimerkiksi avata modal-ikkunan, jossa voi muokata varauksen tietoja ja sitten lähettää päivitetyt tiedot palvelimelle.
        }
    
        function poistaVaraus(varausId) {
            fetch(`/api/polku/poista_varaus/${varausId}`, { method: 'DELETE' }) // Oikea API-reitti tähän
                .then(response => {
                    if (response.ok) {
                        console.log('Varaus poistettu onnistuneesti');
                        haeVaraukset(); // Päivitä varauslista
                    } else {
                        console.error('Virhe poistettaessa varausta');
                    }
                })
                .catch(error => console.error('Poisto epäonnistui:', error));
        }

        /* document.addEventListener("DOMContentLoaded", function() {
            // Oletetaan, että userId on jollakin tavalla saatavilla, esim. kirjautuneen käyttäjän tietona
            const userId = 'kirjautuneen_käyttäjän_id';

            fetch(`/users/${userId}`)
            .then(response => response.json())
            .then(data => {
                // Aseta haetut arvot lomakkeen kenttiin
                document.getElementById('name').value = data.etunimi;
                document.getElementById('lastname').value = data.sukunimi;
                document.getElementById('email').value = data.email;
                document.getElementById('username').value = data.username;
                // Oletetaan, että palvelimen vastauksessa on avaimet etunimi, sukunimi, email, ja username
            })
            .catch(error => console.error('Error fetching user data:', error));
        }); */
    </script>
    

    <!-- Alatunniste -->
    <footer>
        <p>&copy; 2024 Ravintola Ryhmä C</p>
    </footer>

</body>

</html>
