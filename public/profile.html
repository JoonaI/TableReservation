<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oma profiili</title>
    <script src="common.js" defer></script>
    
</head>

<body>

    <!-- Päänavigaatio -->
    <div id="header-placeholder"></div>
    
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            fetch('header.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('header-placeholder').innerHTML = data;
                    updateHeaderAfterLogin();
                });
             // Delegoi kuuntelija document-tasolle ja tarkista, onko klikattu elementti reset-password-button
             document.addEventListener('click', function(event) {
                if (event.target.id === 'reset-password-button') {
                    window.location.href = 'reset-password-page.html';
                }
            }); 
        });
    </script>

    <!-- Pääsisältö -->
    <main id="main-content">
        <section id="profile">
            <h2>Oma profiili</h2>
            <p class="alaotsikko">Tällä sivulla voit tarkastella, muokata tai poistaa omia varauksia.</p>
            <ul id="varaukset-lista">
                <!-- Varaukset lisätään tähän -->
              </ul>
        </section>
    </main>

    <!-- Skriptit -->
    <script>

        // Oletetaan, että kirjautumisen yhteydessä tallennetut käyttäjätiedot sisältävät käyttäjän ID:n
        const userId = 'kirjautuneen_käyttäjän_id'; // Korvataan tämä dynaamisesti haetulla arvolla

        function haeVaraukset() {
            fetch(`/api/polku/käyttäjän_varauksiin/${userId}`) // Oikea API-reitti tähän
                .then(response => response.json())
                .then(varaukset => {
                    const varauksetLista = document.getElementById('varaukset-lista');
                    varauksetLista.innerHTML = ''; // Tyhjennä lista ennen uusien varauksien lisäämistä
                    varaukset.forEach(varaus => {
                        varauksetLista.innerHTML += `
                            <li>
                                Varaus ID: ${varaus.id}, Päivämäärä: ${varaus.päivämäärä}, Aika: ${varaus.aika}, Henkilömäärä: ${varaus.henkilomäärä}
                                <button onclick="muokkaaVarausta(${varaus.id})">Muokkaa</button>
                                <button onclick="poistaVaraus(${varaus.id})">Poista</button>
                            </li>`;
                    });
                })
                .catch(error => console.error('Virhe haettaessa varauksia:', error));
        }
    
        function muokkaaVarausta(varausId) {
            // Tähän voisi lisätä toiminnallisuuden varauksen tietojen muokkaamiseen.
            // Esimerkiksi avata modal-ikkunan, jossa voi muokata varauksen tietoja ja sitten lähettää päivitetyt tiedot palvelimelle.
            console.log(`Muokkaa varausta ID: ${varausId}`);
        }
    
        function poistaVaraus(varausId) {
            fetch(`/api/polku/poista_varaus/${varausId}`, { method: 'DELETE' }) // Oikea API-reitti tähän
                .then(response => {
                    if (response.ok) {
                        console.log('Varaus poistettu onnistuneesti');
                        haeVaraukset(); // Päivitä varauslista
                    } else {
                        console.error('Virhe poistettaessa varausta');
                    }
                })
                .catch(error => console.error('Poisto epäonnistui:', error));
        }
    </script>
    

    <!-- Alatunniste -->
    <footer>
        <p>&copy; 2024 Ravintola Ryhmä C</p>
    </footer>

</body>

</html>
